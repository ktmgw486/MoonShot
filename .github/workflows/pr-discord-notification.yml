name: PR Discord Notification

on:
  pull_request:
    types: [opened, closed]
    branches:
      - main
      - develop

jobs:
  notify:
    runs-on: ubuntu-latest
    # PRì´ ë³‘í•©ëœ ê²½ìš°ë§Œ ì²˜ë¦¬ (openedëŠ” í•­ìƒ ì‹¤í–‰, closedëŠ” mergedì¼ ë•Œë§Œ)
    if: github.event.action == 'opened' || (github.event.action == 'closed' && github.event.pull_request.merged == true)
    
    steps:
      - name: Send Discord Notification
        env:
          DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
        run: |
          # PR ì •ë³´ ì¶”ì¶œ
          PR_NUMBER="${{ github.event.pull_request.number }}"
          PR_TITLE="${{ github.event.pull_request.title }}"
          PR_AUTHOR="${{ github.event.pull_request.user.login }}"
          PR_URL="${{ github.event.pull_request.html_url }}"
          BASE_BRANCH="${{ github.event.pull_request.base.ref }}"
          HEAD_BRANCH="${{ github.event.pull_request.head.ref }}"
          
          # ì•¡ì…˜ íƒ€ì…ì— ë”°ë¥¸ ë©”ì‹œì§€ ì„¤ì •
          if [ "${{ github.event.action }}" = "opened" ]; then
            ACTION_TEXT="ğŸ”” ìƒˆë¡œìš´ PRì´ ì—´ë ¸ìŠµë‹ˆë‹¤"
            COLOR="3066993"  # ì´ˆë¡ìƒ‰
            EMOJI="ğŸš€"
          else
            ACTION_TEXT="âœ… PRì´ ë³‘í•©ë˜ì—ˆìŠµë‹ˆë‹¤"
            COLOR="5793266"  # ë³´ë¼ìƒ‰
            EMOJI="ğŸ‰"
          fi
          
          # Discord Webhook í˜ì´ë¡œë“œ ìƒì„±
          PAYLOAD=$(cat <<EOF
          {
            "embeds": [{
              "title": "${EMOJI} PR #${PR_NUMBER}: ${PR_TITLE}",
              "url": "${PR_URL}",
              "color": ${COLOR},
              "fields": [
                {
                  "name": "ìƒíƒœ",
                  "value": "${ACTION_TEXT}",
                  "inline": true
                },
                {
                  "name": "ì‘ì„±ì",
                  "value": "${PR_AUTHOR}",
                  "inline": true
                },
                {
                  "name": "ë¸Œëœì¹˜",
                  "value": "\`${HEAD_BRANCH}\` â†’ \`${BASE_BRANCH}\`",
                  "inline": false
                }
              ],
              "timestamp": "$(date -u +%Y-%m-%dT%H:%M:%S.000Z)"
            }]
          }
          EOF
          )
          
          # Discordë¡œ ì „ì†¡
          curl -X POST "${DISCORD_WEBHOOK_URL}" \
            -H "Content-Type: application/json" \
            -d "$PAYLOAD"
          
          echo "âœ… Discord ì•Œë¦¼ ì „ì†¡ ì™„ë£Œ"
